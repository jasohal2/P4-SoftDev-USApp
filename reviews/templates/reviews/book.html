{% extends "base.html" %} {% load review_extras %} {% block content %}
<div class="page-wrapper" id="page-top">
  <h1>{{ book.title }}</h1>
  <div class="book_description">
    {% if book.image %}
    <img
      src="{{ book.image.url }}"
      class="book_description-image"
      alt="Cover image of {{ book.title }}"
    />
    {% endif %}
    <div class="book_description-text"><p>{{ book.description }}</p></div>
  </div>
  {% if user.is_authenticated %}
  <a href="{% url 'review_create' book.id %}" class="btn"
    >Post a review for this book</a
  >
  {% else %}
    <p class="cta"><a href="{% url 'login' %}">Log in</a> or <a href="{% url 'signup' %}">Sign up</a> to post a review for this book.</p>
  {% endif %}
  <ul class="reviews-list">
    {% for review in reviews %}
    <li class="review-item" id="review-{{ review.id }}">
      New Review by
      <a href="{% url 'user_profile' review.user.username %}"
        >{{ review.user.username }}</a
      >
      on {{ review.created|date:"M j, Y \\a\\t g:i A" }}
      <br />
      <br />
      <h3 class="review-headline">
        <span class="review-headline-text">{{ review.headline }}</span>
        <span
          class="book-rating"
          aria-label="Rating: {{ review.rating }} out of 5"
        >
          {% render_stars review.rating %}
        </span>
      </h3>
      <br />
      <br />
      {{ review.body }}
    </li>
    {% empty %}
    <li>No reviews available.</li>
    {% endfor %}
  </ul>

  {% if reviews|length > 5 %}
  <a href="#page-top" class="back-to-top-link">Back to top ↑</a>
  {% endif %}

  <a href="{% url 'home' %}" class="btn btn-ghost home-btn">
    <svg class="icon icon-home" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path fill="currentColor" d="M12 3l9 8h-3v9h-5v-6H11v6H6v-9H3l9-8Z"/></svg>
    Home
  </a>
  <br />
  <br />
</div>
{% endblock content %}

{% block extra_scripts %}
<script>
// Floating Back to Top button logic
document.addEventListener('DOMContentLoaded', function() {
  const fab = document.createElement('a');
  fab.href = '#page-top';
  fab.className = 'back-to-top-fab';
  fab.setAttribute('aria-label', 'Back to top');
  fab.innerHTML = '↑';
  document.body.appendChild(fab);

  const showAfter = 600; // px scrolled
  function onScroll() {
    if (window.scrollY > showAfter) {
      fab.classList.add('visible');
    } else {
      fab.classList.remove('visible');
    }
  }
  window.addEventListener('scroll', onScroll, { passive: true });
  onScroll();
});
</script>
{% endblock extra_scripts %}
